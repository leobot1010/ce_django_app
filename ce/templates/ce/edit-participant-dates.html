{% extends 'base.html' %}

{% block content %}
  <div class="container mt-5">

    <!-- Page heading -->
    <h2 class="mb-5 pb-2 border-bottom">
        Edit Dates for <strong>{{ participant.first_name }} {{ participant.last_name }}</strong>
    </h2>

    <form method="post">
      {% csrf_token %}

      <!-- -------------------------------------- CE Scheme Dates ------------------------------------>

      <h5 class="mb-4">CE Scheme Dates</h5>

      <div class="mb-3 row align-items-center">
          <label for="id_scheme_start_date" class="col-sm-2 col-form-label mb-0">
              Start Date
          </label>
          <div class="col-sm-10">
            {{ form.scheme_start_date }}
          </div>
      </div>


      <div class="mb-3 row align-items-center">

          <label for="id_scheme_finish_date" class="col-sm-2 col-form-label mb-0">
                Finish Date
          </label>

          <div class="col-sm-10 d-flex align-items-center gap-2">
                  {{ form.scheme_finish_date }}

            <!------------- Plus and Minus Buttons ------------>
            <button type="button"
                    class="btn btn-sm px-1 py-0 date-adjust-btn"
                    style="font-size: 0.65rem; border: none; color: white; width: 2rem;"
                    onclick="adjustFinishDate(-182)">âˆ’6m</button>

            <button type="button"
                    class="btn btn-sm px-1 py-0 date-adjust-btn"
                    style="font-size: 0.65rem; border: none; color: white; width: 2rem;"
                    onclick="adjustFinishDate(182)">+6m</button>

          </div>

      </div>



      <!------------------------------------- Manual Handling Dates -------------------------------->

      <h5 class="mt-5 mb-4">Manual Handling Dates</h5>

      <div class="mb-3 row align-items-center">
        <label for="id_participant_start_date" class="col-sm-2 col-form-label mb-0">
          Start Date
        </label>
        <div class="col-sm-10">
          {{ form.manual_start_date }}
        </div>
      </div>

    <div class="mb-3 row align-items-center">
      <label for="id_participant_end_date" class="col-sm-2 col-form-label mb-0">
        Finish Date
      </label>
      <div class="col-sm-10">
        {{ form.manual_finish_date }}
      </div>
    </div>


      <!----------------------------------- Save and Cancel Buttons ----------------------------------->
      <div class="mt-4">
        <button type="submit" class="btn-teal">Save Dates</button>
        <a href="{% url 'view_participants' %}" class="btn-slate">Cancel</a>
      </div>
    </form>

  </div>


<!------------------------------------------------------ CSS -------------------------------------------------------->

<!----- Plus Minus Buttons ----->

<style>
  .date-adjust-btn {
    font-size: 0.65rem;
    background-color: #6c757d; /* slate */
    border: none;
    color: white;
    width: 2.5rem;
  }

  .date-adjust-btn:hover {
    background-color: #5c636a; /* slightly darker on hover */
  }
</style>


<!-- ------------------------------------------------- JAVASCRIPT ---------------------------------------------------->

<script>
function adjustFinishDate(offsetDays) {
    const input = document.getElementById("id_scheme_finish_date");
    if (!input || !input.value) return;

    const currentDate = new Date(input.value);
    if (isNaN(currentDate)) return;

    // Add/subtract days
    currentDate.setDate(currentDate.getDate() + offsetDays);

    // Adjust forward to the next Friday if needed
    const day = currentDate.getDay(); // 5 = Friday
    const daysToFriday = (5 - day + 7) % 7;
    currentDate.setDate(currentDate.getDate() + daysToFriday);

    // Format as yyyy-mm-dd
    const yyyy = currentDate.getFullYear();
    const mm = String(currentDate.getMonth() + 1).padStart(2, '0');
    const dd = String(currentDate.getDate()).padStart(2, '0');
    input.value = `${yyyy}-${mm}-${dd}`;
}
</script>



{% endblock %}

