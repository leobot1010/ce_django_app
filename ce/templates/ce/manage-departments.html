
{% extends "base.html" %}
{% block title %}Manage Departments{% endblock %}

{% block content %}
<h2>Manage Departments for {{ scheme.name }}</h2>


<!----------------------------- ADD DEPARTMENT FORM -------------------------->

<!-- Always render the Add Department form -->
<form method="POST" class="d-flex align-items-center mb-3" action="">
    {% csrf_token %}

    <!-- Empty input when editing to avoid confusion -->
    <input type="text" name="name"
           value="{% if not edit_dept %}{{ request.POST.name|default:'' }}{% else %}{% endif %}"
           placeholder="Department name"
           class="form-control me-2"
           required style="max-width: 300px;">

    {% if not edit_dept %}
        <!-- Only show Add button when not editing -->
        <button type="submit"
                class="btn btn-outline-secondary bg-light p-0 d-flex align-items-center justify-content-center"
                title="Add Department"
                style="width: 26px; height: 26px; border-radius: 0.25rem; margin-top: 2px;">
            <i class="bi bi-plus" style="font-size: 1.4rem; pointer-events: none;"></i>
        </button>
    {% endif %}
</form>


<!------------------------------- ERROR MESSAGE ------------------------------->
{% if error %}
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    {{ error }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
{% endif %}


<!-------------------------- LIST OF DEPARTMENTS TABLE ------------------------>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Department</th>
            <th style="width: 150px;">Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for dept in departments %}
    <tr>
        {% if edit_dept and dept.id == edit_dept.id %}
            <td colspan="2">
                <form method="POST" action="" class="d-flex gap-2 align-items-center">
                    {% csrf_token %}
                    <input type="hidden" name="edit_id" value="{{ dept.id }}">
                    <input type="text" name="name" value="{{ dept.name }}" class="form-control" style="max-width: 300px;" required>
                    <button type="submit" class="btn btn-sm btn-success">Save</button>
                    <a href="{% url 'manage_departments' %}" class="btn btn-sm btn-secondary">Cancel</a>
                </form>
            </td>
        {% else %}
            <td>{{ dept.name }}</td>
            <td>


                <!---------------------------- EDIT AND DELETE BUTTONS -------------------------->

                <a href="?edit={{ dept.id }}"
                   class="btn btn-outline-secondary bg-light py-0 px-1 me-2"
                   style="border-radius: 0.25rem;"
                   title="Edit">
                  <i class="bi bi-pencil-square fs-6" style="pointer-events: none;"></i>
                </a>

                <a href="#" onclick="openDeleteModal('{{ dept.id }}'); return false;"
                   class="btn btn-outline-danger bg-light py-0 px-1"
                   style="border-radius: 0.25rem;"
                   title="Delete">
                  <i class="bi bi-trash3 fs-6" style="pointer-events: none;"></i>
                </a>


            </td>
        {% endif %}
    </tr>
    {% endfor %}
</tbody>

</table>
<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this department?
      </div>
      <div class="modal-footer">
        <a id="confirmDeleteBtn" href="#" class="btn btn-danger">Delete</a>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>


<!-- --------------------------------------- JAVASCRIPT ---------------------------------------------->
<script>
    function openDeleteModal(deptId) {
        const deleteUrl = `/manage-departments/?delete=${deptId}`;
        document.getElementById("confirmDeleteBtn").href = deleteUrl;
        const modal = new bootstrap.Modal(document.getElementById("deleteConfirmModal"));
        modal.show();
    }

</script>

<script>
    setTimeout(() => {
      const alert = document.querySelector(".alert");
      if (alert) alert.remove();
    }, 5000);
</script>


<!-- -------------------------------------- CSS STYLING ----------------------------------------------->

<!------------------EDIT AND DELETE BUTTONS -------------->

<style>
  .btn-outline-secondary,
  .btn-outline-danger {
    background-color: #f8f9fa;
    border-radius: 4px;
    padding: 4px 6px;
    transition: all 0.2s ease;
  }

  .btn-outline-secondary:hover,
  .btn-outline-danger:hover {
    background-color: #dee2e6; /* more visible hover */
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    transform: translateY(-1px); /* gentle lift */
  }

  .btn-outline-secondary i,
  .btn-outline-danger i {
    color: #495057;
    transition: color 0.2s ease;
  }

  .btn-outline-danger i {
    color: #dc3545;
  }

  .btn-outline-danger:hover i {
    color: #b02a37;
  }

  .btn-outline-secondary:hover i {
    color: #212529;
  }
</style>


 <!------------- ADD BUTTON ------------->

<style>
  .icon-button {
    border: none;
    background: transparent;
    padding: 0;
    line-height: 1;
    cursor: pointer;
    border-radius: 0.25rem;
  }

  .icon-button i {
    font-size: 1.5rem;
    color: #6c757d; /* Match edit button gray */
    transition: all 0.2s ease-in-out;
    padding: 0.25rem;
  }

  .icon-button:hover i {
    color: #5a6268; /* Slightly darker gray */
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); /* Subtle pop-up */
    background-color: #f8f9fa; /* Very light background, like edit */
    border-radius: 0.25rem;
  }
</style>



{% endblock %}
